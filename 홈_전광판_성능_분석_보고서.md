# 홈 전광판 성능 분석 보고서 (300명 기준)

## 현재 상태

### 발견된 성능 문제

1. **모든 선수의 로그를 한 번에 가져오는 부분 (2905-2925 라인)**
   ```typescript
   await Promise.all(playerIds.map(async (pid) => {
       const logs = await getPlayerScoreLogsOptimized(pid);
       logsMap[pid] = logs;
   }));
   ```
   - 300명의 선수에 대해 각각 로그를 가져옴
   - Promise.all로 병렬 처리하지만 여전히 300번의 네트워크 요청
   - `finalDataByGroup`이 변경될 때마다 재실행됨

2. **복잡한 데이터 처리 (`processedDataByGroup` useMemo)**
   - 300명의 선수를 모두 처리
   - 각 선수마다:
     - 코스별 점수 계산
     - 백카운트 계산
     - 순위 계산
     - 기권 타입 확인
   - 300명 × 여러 코스 × 9홀 = 수천 개의 데이터 포인트 처리

3. **Firebase 리스너**
   - `onValue`로 전체 players, scores 데이터를 실시간으로 받음
   - 300명의 선수 데이터가 변경될 때마다 전체 재계산

## 성능 개선 방안

### 1. 로그 로딩 최적화 (우선순위: 높음)

**현재 문제:**
- 300명의 로그를 한 번에 가져옴
- `finalDataByGroup`이 변경될 때마다 재실행

**개선 방안:**
- 로그는 필요할 때만 가져오기 (예: 기권 타입이 있는 선수만)
- 또는 페이지네이션/지연 로딩 적용
- 또는 로그를 캐싱하여 중복 요청 방지

### 2. 데이터 처리 최적화 (우선순위: 높음)

**현재 문제:**
- 300명의 선수를 모두 처리
- 복잡한 계산이 매번 실행됨

**개선 방안:**
- 가상 스크롤링 적용 (화면에 보이는 선수만 렌더링)
- 그룹별로 분할 처리
- 계산 결과 캐싱

### 3. Firebase 리스너 최적화 (우선순위: 중간)

**현재 문제:**
- 전체 데이터를 실시간으로 받음

**개선 방안:**
- `onChildChanged`를 더 적극적으로 활용
- 변경된 데이터만 업데이트
- 디바운싱/쓰로틀링 적용

## 권장 조치

### 즉시 적용 가능한 개선

1. **로그 로딩 최적화**
   - 기권 타입이 있는 선수만 로그 가져오기
   - 또는 로그를 지연 로딩 (필요할 때만)

2. **가상 스크롤링**
   - 화면에 보이는 선수만 렌더링
   - 300명 전체를 한 번에 렌더링하지 않음

3. **계산 결과 캐싱**
   - 점수가 변경되지 않은 선수는 재계산하지 않음

### 장기 개선 방안

1. **서버 사이드 최적화**
   - 백카운트 계산을 서버에서 수행
   - 클라이언트는 결과만 받기

2. **데이터베이스 구조 개선**
   - 인덱싱 최적화
   - 불필요한 데이터 제거

## 결론

**300명 규모에서 버벅거리는 것은 정상이 아닙니다.**

현재 코드는 작은 규모(50명 이하)에서는 문제없지만, 300명 규모에서는 성능 문제가 발생합니다.

**즉시 개선이 필요한 부분:**
1. 로그 로딩 최적화 (가장 큰 병목)
2. 가상 스크롤링 적용
3. 불필요한 재계산 방지

이러한 최적화를 적용하면 300명 규모에서도 부드럽게 동작할 수 있습니다.


# 3ê°€ì§€ ê°œì„ ì‚¬í•­ ë³´ì™„ ë°©ì•ˆ ìƒì„¸ ë¶„ì„

## ê²€í†  ì¼ì: 2024ë…„
## ê²€í†  ë²”ìœ„: ê·¸ë£¹ íƒ€ì… ì¼ì¹˜ í™•ì¸, Firebase ì¸ì¦ ì¬ì‹œë„, ë°±ì¹´ìš´íŠ¸ ì½”ìŠ¤ ìˆœì„œ ê²€ì¦

---

## 1. ê·¸ë£¹ ìƒì„± ì‹œ íƒ€ì… ì¼ì¹˜ í™•ì¸ ê°•í™”

### ğŸ“ í˜„ì¬ ìƒí™© ë¶„ì„

**í˜„ì¬ ì½”ë“œ ìœ„ì¹˜**: `src/app/admin/players/page.tsx`

**1.1 ê·¸ë£¹ ìƒì„± ì‹œ (1221-1244ë²ˆ ì¤„)**
```typescript
const handleAddGroup = (type: 'individual' | 'team') => {
    // ... ê·¸ë£¹ ì´ë¦„ ê²€ì¦ ...
    set(groupRef, { name: trimmedName, type, courses: defaultCourses })
        .then(() => {
            toast({ title: 'ì„±ê³µ', description: `ìƒˆ ê·¸ë£¹ '${trimmedName}'ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.` });
        });
};
```

**ë¬¸ì œì **:
- ê·¸ë£¹ ìƒì„± ì‹œ í•´ë‹¹ íƒ€ì…ì˜ ì„ ìˆ˜ê°€ ì´ë¯¸ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸í•˜ì§€ ì•ŠìŒ
- ì„ ìˆ˜ ì—…ë¡œë“œ ì‹œ ê·¸ë£¹ íƒ€ì…ê³¼ ì„ ìˆ˜ íƒ€ì…ì´ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸í•˜ì§€ë§Œ, ê·¸ë£¹ ìƒì„± ì‹œì—ëŠ” í™•ì¸í•˜ì§€ ì•ŠìŒ

**1.2 ì„ ìˆ˜ ì—…ë¡œë“œ ì‹œ (381-497ë²ˆ ì¤„)**
```typescript
const handleFileUpload = (e: React.ChangeEvent<HTMLInputElement>, type: 'individual' | 'team') => {
    // ê·¸ë£¹ëª… ì²´í¬ëŠ” ìˆì§€ë§Œ, ê·¸ë£¹ íƒ€ì…ê³¼ ì„ ìˆ˜ íƒ€ì… ì¼ì¹˜ í™•ì¸ì€ ì—†ìŒ
    const groupList = Object.values(groupsData)
        .filter((g: any) => g.type === type)  // ì´ë¯¸ íƒ€ì… í•„í„°ë§ì€ í•¨
        .map((g: any) => g.name);
};
```

**ë¬¸ì œì **:
- ì—‘ì…€ íŒŒì¼ì˜ ê·¸ë£¹ëª…ì´ íƒ€ì…ì— ë§ëŠ” ê·¸ë£¹ ëª©ë¡ì— ìˆëŠ”ì§€ë§Œ í™•ì¸
- í•˜ì§€ë§Œ ê·¸ë£¹ì— ì´ë¯¸ ë‹¤ë¥¸ íƒ€ì…ì˜ ì„ ìˆ˜ê°€ ìˆëŠ”ì§€ëŠ” í™•ì¸í•˜ì§€ ì•ŠìŒ

### âœ… ë³´ì™„ ë°©ì•ˆ

#### ë°©ì•ˆ 1-1: ê·¸ë£¹ ìƒì„± ì‹œ ê¸°ì¡´ ì„ ìˆ˜ íƒ€ì… í™•ì¸

**ìˆ˜ì • ìœ„ì¹˜**: `src/app/admin/players/page.tsx` - `handleAddGroup` í•¨ìˆ˜

**ìˆ˜ì • ë‚´ìš©**:
```typescript
const handleAddGroup = (type: 'individual' | 'team') => {
    const trimmedName = newGroupName.trim();
    if (trimmedName === "") {
        toast({ title: 'ì˜¤ë¥˜', description: 'ê·¸ë£¹ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.' });
        return;
    }
    if (groupsData[trimmedName]) {
        toast({ title: 'ì˜¤ë¥˜', description: 'ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ê·¸ë£¹ ì´ë¦„ì…ë‹ˆë‹¤.' });
        return;
    }

    // ğŸ”¥ ì¶”ê°€: í•´ë‹¹ ê·¸ë£¹ì— ì´ë¯¸ ë‹¤ë¥¸ íƒ€ì…ì˜ ì„ ìˆ˜ê°€ ìˆëŠ”ì§€ í™•ì¸
    const existingPlayersInGroup = allPlayers.filter((p: any) => p.group === trimmedName);
    if (existingPlayersInGroup.length > 0) {
        const conflictingType = existingPlayersInGroup[0].type;
        const conflictingTypeName = conflictingType === 'individual' ? 'ê°œì¸ì „' : '2ì¸1íŒ€';
        const newTypeName = type === 'individual' ? 'ê°œì¸ì „' : '2ì¸1íŒ€';
        
        toast({
            title: 'íƒ€ì… ë¶ˆì¼ì¹˜',
            description: `'${trimmedName}' ê·¸ë£¹ì— ì´ë¯¸ ${conflictingTypeName} ì„ ìˆ˜ê°€ ${existingPlayersInGroup.length}ëª… ë“±ë¡ë˜ì–´ ìˆìŠµë‹ˆë‹¤.\n${newTypeName} ê·¸ë£¹ì„ ìƒì„±í•˜ë ¤ë©´ ë¨¼ì € ê¸°ì¡´ ì„ ìˆ˜ë¥¼ ì‚­ì œí•˜ê±°ë‚˜ ë‹¤ë¥¸ ê·¸ë£¹ìœ¼ë¡œ ì´ë™ì‹œì¼œì£¼ì„¸ìš”.`,
            variant: 'destructive'
        });
        return;
    }

    const groupRef = ref(db!, `tournaments/current/groups/${trimmedName}`);
    const defaultCourses = courses.reduce((acc, course) => {
        acc[course.id] = true;
        return acc;
    }, {});

    set(groupRef, { name: trimmedName, type, courses: defaultCourses })
        .then(() => {
            toast({ title: 'ì„±ê³µ', description: `ìƒˆ ê·¸ë£¹ '${trimmedName}'ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.` });
            setNewGroupName("");
        })
        .catch(err => toast({ title: 'ì˜¤ë¥˜', description: err.message }));
};
```

#### ë°©ì•ˆ 1-2: ì„ ìˆ˜ ì—…ë¡œë“œ ì‹œ ê·¸ë£¹ íƒ€ì… ì¼ì¹˜ í™•ì¸ ê°•í™”

**ìˆ˜ì • ìœ„ì¹˜**: `src/app/admin/players/page.tsx` - `handleFileUpload` í•¨ìˆ˜

**ìˆ˜ì • ë‚´ìš©**:
```typescript
const handleFileUpload = (e: React.ChangeEvent<HTMLInputElement>, type: 'individual' | 'team') => {
    // ... ê¸°ì¡´ ì½”ë“œ ...
    
    // ğŸ”¥ ì¶”ê°€: ê° ê·¸ë£¹ì— ì´ë¯¸ ë‹¤ë¥¸ íƒ€ì…ì˜ ì„ ìˆ˜ê°€ ìˆëŠ”ì§€ í™•ì¸
    const typeConflicts: string[] = [];
    sheetNames.forEach((groupName: string) => {
        const groupData = groupsData[groupName];
        if (!groupData) return; // ê·¸ë£¹ì´ ì—†ìœ¼ë©´ ë‹¤ìŒ ë‹¨ê³„ì—ì„œ ì²˜ë¦¬ë¨
        
        // ê·¸ë£¹ íƒ€ì… í™•ì¸
        if (groupData.type !== type) {
            typeConflicts.push(`${groupName} (ê·¸ë£¹ íƒ€ì…: ${groupData.type === 'individual' ? 'ê°œì¸ì „' : '2ì¸1íŒ€'}, ì—…ë¡œë“œ íƒ€ì…: ${type === 'individual' ? 'ê°œì¸ì „' : '2ì¸1íŒ€'})`);
        }
        
        // ê¸°ì¡´ ì„ ìˆ˜ íƒ€ì… í™•ì¸
        const existingPlayers = allPlayers.filter((p: any) => p.group === groupName);
        if (existingPlayers.length > 0) {
            const existingType = existingPlayers[0].type;
            if (existingType !== type) {
                typeConflicts.push(`${groupName} (ê¸°ì¡´ ì„ ìˆ˜ íƒ€ì…: ${existingType === 'individual' ? 'ê°œì¸ì „' : '2ì¸1íŒ€'}, ì—…ë¡œë“œ íƒ€ì…: ${type === 'individual' ? 'ê°œì¸ì „' : '2ì¸1íŒ€'})`);
            }
        }
    });
    
    if (typeConflicts.length > 0) {
        toast({
            title: 'íƒ€ì… ë¶ˆì¼ì¹˜',
            description: `ë‹¤ìŒ ê·¸ë£¹ì—ì„œ íƒ€ì…ì´ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤:\n${typeConflicts.join('\n')}\n\nì˜¬ë°”ë¥¸ íƒ€ì…ì˜ ê·¸ë£¹ì„ ì„ íƒí•˜ê±°ë‚˜ ê¸°ì¡´ ì„ ìˆ˜ë¥¼ ë¨¼ì € ì‚­ì œí•´ì£¼ì„¸ìš”.`,
            variant: 'destructive'
        });
        return;
    }
    
    // ... ë‚˜ë¨¸ì§€ ì½”ë“œ ...
};
```

### âš ï¸ ì˜í–¥ ë²”ìœ„ ë¶„ì„

**ì˜í–¥ì„ ë°›ëŠ” ì½”ë“œ**:
1. `handleAddGroup`: ê·¸ë£¹ ìƒì„± ì‹œ íƒ€ì… í™•ì¸ ì¶”ê°€
2. `handleFileUpload`: ì„ ìˆ˜ ì—…ë¡œë“œ ì‹œ íƒ€ì… í™•ì¸ ê°•í™”

**ì˜í–¥ì„ ë°›ì§€ ì•ŠëŠ” ì½”ë“œ**:
- ê¸°ì¡´ ê·¸ë£¹ ìˆ˜ì • ê¸°ëŠ¥
- ì„ ìˆ˜ ìˆ˜ì • ê¸°ëŠ¥
- ì¡° ì¬í¸ì„± ê¸°ëŠ¥
- ì „ê´‘íŒ ë° ì ìˆ˜ ê³„ì‚° ë¡œì§

**ì ì¬ì  ë¶€ì‘ìš©**:
- **ì—†ìŒ**: íƒ€ì… í™•ì¸ë§Œ ì¶”ê°€ë˜ë¯€ë¡œ ê¸°ì¡´ ê¸°ëŠ¥ì— ì˜í–¥ ì—†ìŒ
- ì˜¤íˆë ¤ ë°ì´í„° ë¬´ê²°ì„± í–¥ìƒ

---

## 2. Firebase ì¸ì¦ ì‹¤íŒ¨ ì‹œ ì¬ì‹œë„ ë¡œì§ ê°•í™”

### ğŸ“ í˜„ì¬ ìƒí™© ë¶„ì„

**í˜„ì¬ ì½”ë“œ ìœ„ì¹˜**: 
- `src/lib/firebase.ts` - `ensureAuthenticated` í•¨ìˆ˜ (32-55ë²ˆ ì¤„)
- `src/app/self-scoring/batch-scoring/page.tsx` - `saveToFirebase` í•¨ìˆ˜ (1026-1144ë²ˆ ì¤„)
- `src/app/self-scoring/batch-scoring/page.tsx` - `handleBatchSave` í•¨ìˆ˜ (1147-1285ë²ˆ ì¤„)

**2.1 í˜„ì¬ ì¸ì¦ í•¨ìˆ˜ (`src/lib/firebase.ts`)**
```typescript
export const ensureAuthenticated = async (): Promise<boolean> => {
    if (!auth) return false;
    
    try {
        const currentUser = auth.currentUser;
        if (currentUser) return true;
        
        const userCredential = await signInAnonymously(auth);
        return true;
    } catch (error) {
        console.error('Firebase ì¸ì¦ ì‹¤íŒ¨:', error);
        return false;  // ì¬ì‹œë„ ì—†ìŒ
    }
};
```

**ë¬¸ì œì **:
- ì¸ì¦ ì‹¤íŒ¨ ì‹œ ì¦‰ì‹œ `false` ë°˜í™˜
- ì¬ì‹œë„ ë¡œì§ ì—†ìŒ
- ë„¤íŠ¸ì›Œí¬ ì¼ì‹œì  ì˜¤ë¥˜ ì‹œ ì‹¤íŒ¨

**2.2 í˜„ì¬ ì ìˆ˜ ì €ì¥ ì‹œ ì¬ì‹œë„ (`batch-scoring/page.tsx`)**
```typescript
const maxRetries = isMobile ? 5 : 1; // ëª¨ë°”ì¼ì—ì„œë§Œ ì¬ì‹œë„
while (attempt < maxRetries) {
    try {
        await set(scoreRef, score);
        break;
    } catch (e: any) {
        attempt++;
        const isPermissionError = e?.code === 'PERMISSION_DENIED' || ...;
        if (isPermissionError && attempt < maxRetries && isMobile) {
            continue;  // ëª¨ë°”ì¼ì—ì„œë§Œ ì¬ì‹œë„
        }
        return;  // ì‹¤íŒ¨ ì‹œ ì¢…ë£Œ
    }
}
```

**ë¬¸ì œì **:
- PCì—ì„œëŠ” ì¬ì‹œë„ ì—†ìŒ (`maxRetries = 1`)
- ì¸ì¦ ì‹¤íŒ¨ ì‹œ ì¬ì¸ì¦ ì‹œë„ ì—†ìŒ
- ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ì™€ ì¸ì¦ ì˜¤ë¥˜ êµ¬ë¶„ ì—†ìŒ

### âœ… ë³´ì™„ ë°©ì•ˆ

#### ë°©ì•ˆ 2-1: `ensureAuthenticated` í•¨ìˆ˜ì— ì¬ì‹œë„ ë¡œì§ ì¶”ê°€

**ìˆ˜ì • ìœ„ì¹˜**: `src/lib/firebase.ts`

**ìˆ˜ì • ë‚´ìš©**:
```typescript
export const ensureAuthenticated = async (maxRetries: number = 3, retryDelay: number = 1000): Promise<boolean> => {
    if (!auth) {
        console.error('Firebase Authê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
        return false;
    }

    let attempt = 0;
    
    while (attempt < maxRetries) {
        try {
            const currentUser = auth.currentUser;
            
            if (currentUser) {
                console.log('ì´ë¯¸ ì¸ì¦ëœ ì‚¬ìš©ì:', currentUser.uid);
                return true;
            }

            console.log(`ìµëª… ì¸ì¦ ì‹œë„ ì¤‘... (${attempt + 1}/${maxRetries})`);
            const userCredential = await signInAnonymously(auth);
            console.log('ìµëª… ì¸ì¦ ì„±ê³µ:', userCredential.user.uid);
            return true;
            
        } catch (error: any) {
            attempt++;
            console.error(`Firebase ì¸ì¦ ì‹¤íŒ¨ (${attempt}/${maxRetries}):`, error);
            
            // ì¬ì‹œë„ ê°€ëŠ¥í•œ ì˜¤ë¥˜ì¸ì§€ í™•ì¸
            const isRetryableError = 
                error?.code === 'auth/network-request-failed' ||
                error?.code === 'auth/too-many-requests' ||
                error?.message?.includes('network') ||
                error?.message?.includes('timeout');
            
            if (isRetryableError && attempt < maxRetries) {
                // ì§€ìˆ˜ ë°±ì˜¤í”„: 1ì´ˆ, 2ì´ˆ, 4ì´ˆ...
                const delay = retryDelay * Math.pow(2, attempt - 1);
                console.log(`${delay}ms í›„ ì¬ì‹œë„...`);
                await new Promise(resolve => setTimeout(resolve, delay));
                continue;
            }
            
            // ì¬ì‹œë„ ë¶ˆê°€ëŠ¥í•œ ì˜¤ë¥˜ ë˜ëŠ” ìµœëŒ€ ì¬ì‹œë„ íšŸìˆ˜ ì´ˆê³¼
            if (attempt >= maxRetries) {
                console.error('Firebase ì¸ì¦ ìµœì¢… ì‹¤íŒ¨: ìµœëŒ€ ì¬ì‹œë„ íšŸìˆ˜ ì´ˆê³¼');
            }
            return false;
        }
    }
    
    return false;
};
```

#### ë°©ì•ˆ 2-2: ì ìˆ˜ ì €ì¥ ì‹œ ì¸ì¦ ì¬ì‹œë„ ì¶”ê°€

**ìˆ˜ì • ìœ„ì¹˜**: `src/app/self-scoring/batch-scoring/page.tsx` - `saveToFirebase` í•¨ìˆ˜

**ìˆ˜ì • ë‚´ìš©**:
```typescript
const saveToFirebase = async (playerIndex: number, holeIndex: number, score: number) => {
    if (!db || !activeCourse) return;
    
    // ... ê¸°ì¡´ ì½”ë“œ ...
    
    // ğŸ”¥ ê°œì„ : ì¸ì¦ ì‹¤íŒ¨ ì‹œ ì¬ì¸ì¦ ì‹œë„
    let isAuthenticated = await ensureAuthenticated();
    if (!isAuthenticated) {
        // ì¬ì¸ì¦ ì‹œë„ (ìµœëŒ€ 2íšŒ)
        for (let authRetry = 0; authRetry < 2; authRetry++) {
            console.log(`ì¸ì¦ ì¬ì‹œë„ ì¤‘... (${authRetry + 1}/2)`);
            await new Promise(resolve => setTimeout(resolve, 1000 * (authRetry + 1))); // 1ì´ˆ, 2ì´ˆ ëŒ€ê¸°
            isAuthenticated = await ensureAuthenticated();
            if (isAuthenticated) break;
        }
        
        if (!isAuthenticated) {
            toast({
                title: "ì¸ì¦ ì‹¤íŒ¨",
                description: "Firebase ì¸ì¦ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ê³  ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.",
                variant: "destructive"
            });
            return;
        }
    }
    
    // ëª¨ë°”ì¼ í™˜ê²½ ê°ì§€ ë° Firebase ì¸ì¦ ì¬ì‹œë„ ë¡œì§
    const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    const maxRetries = isMobile ? 5 : 3; // ğŸ”¥ PCì—ì„œë„ ì¬ì‹œë„ (3íšŒ)
    let attempt = 0;
    
    while (attempt < maxRetries) {
        try {
            // ... ê¸°ì¡´ ì €ì¥ ë¡œì§ ...
            
            // ì„±ê³µí•˜ë©´ ë£¨í”„ ì¢…ë£Œ
            break;
            
        } catch (e: any) {
            attempt++;
            
            // ğŸ”¥ ê°œì„ : ì¸ì¦ ì˜¤ë¥˜ ì‹œ ì¬ì¸ì¦ ì‹œë„
            const isPermissionError = e?.code === 'PERMISSION_DENIED' ||
                e?.message?.includes('permission_denied') ||
                e?.message?.includes('Permission denied') ||
                e?.message?.includes('auth') ||
                e?.message?.includes('authentication');
            
            if (isPermissionError && attempt < maxRetries) {
                // ì¸ì¦ ì¬ì‹œë„
                console.log(`ì¸ì¦ ì˜¤ë¥˜ ê°ì§€, ì¬ì¸ì¦ ì‹œë„ ì¤‘... (${attempt}/${maxRetries})`);
                const reAuthSuccess = await ensureAuthenticated(2, 500); // ìµœëŒ€ 2íšŒ, 0.5ì´ˆ ê°„ê²©
                
                if (reAuthSuccess) {
                    // ì¬ì¸ì¦ ì„±ê³µ ì‹œ ë‹¤ì‹œ ì €ì¥ ì‹œë„
                    const delay = isMobile ? 1500 * attempt : 1000 * attempt;
                    await new Promise(resolve => setTimeout(resolve, delay));
                    continue;
                }
            }
            
            // ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ë„ ì¬ì‹œë„
            const isNetworkError = e?.code === 'network-request-failed' ||
                e?.message?.includes('network') ||
                e?.message?.includes('timeout');
            
            if (isNetworkError && attempt < maxRetries) {
                const delay = isMobile ? 1500 * attempt : 1000 * attempt;
                await new Promise(resolve => setTimeout(resolve, delay));
                continue;
            }
            
            // ìµœì¢… ì‹¤íŒ¨
            const errorMsg = e?.code === 'PERMISSION_DENIED'
                ? 'ì ìˆ˜ ì €ì¥ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ê³  ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.'
                : (e?.message || "ì ìˆ˜ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
            
            toast({
                title: "ì €ì¥ ì‹¤íŒ¨",
                description: errorMsg,
                variant: "destructive"
            });
            return;
        }
    }
    
    // ... ë‚˜ë¨¸ì§€ ì½”ë“œ ...
};
```

#### ë°©ì•ˆ 2-3: ì¼ê´„ ì €ì¥ ì‹œ ì¸ì¦ ì¬ì‹œë„ ì¶”ê°€

**ìˆ˜ì • ìœ„ì¹˜**: `src/app/self-scoring/batch-scoring/page.tsx` - `handleBatchSave` í•¨ìˆ˜

**ìˆ˜ì • ë‚´ìš©**:
```typescript
const handleBatchSave = async () => {
    // ... ê¸°ì¡´ ì½”ë“œ ...
    
    // ğŸ”¥ ê°œì„ : ì¸ì¦ ì‹¤íŒ¨ ì‹œ ì¬ì¸ì¦ ì‹œë„
    let isAuthenticated = await ensureAuthenticated();
    if (!isAuthenticated) {
        // ì¬ì¸ì¦ ì‹œë„ (ìµœëŒ€ 2íšŒ)
        for (let authRetry = 0; authRetry < 2; authRetry++) {
            console.log(`ì¸ì¦ ì¬ì‹œë„ ì¤‘... (${authRetry + 1}/2)`);
            await new Promise(resolve => setTimeout(resolve, 1000 * (authRetry + 1)));
            isAuthenticated = await ensureAuthenticated();
            if (isAuthenticated) break;
        }
        
        if (!isAuthenticated) {
            toast({
                title: "ì¸ì¦ ì‹¤íŒ¨",
                description: "Firebase ì¸ì¦ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ê³  ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.",
                variant: "destructive"
            });
            setIsSaving(false);
            return;
        }
    }
    
    // ... ë‚˜ë¨¸ì§€ ì½”ë“œ ...
};
```

### âš ï¸ ì˜í–¥ ë²”ìœ„ ë¶„ì„

**ì˜í–¥ì„ ë°›ëŠ” ì½”ë“œ**:
1. `src/lib/firebase.ts` - `ensureAuthenticated` í•¨ìˆ˜
2. `src/app/self-scoring/batch-scoring/page.tsx` - `saveToFirebase`, `handleBatchSave`
3. `src/app/self-scoring/scoring/page.tsx` - `saveToFirebase` (ë™ì¼í•œ íŒ¨í„´ ì ìš© ê°€ëŠ¥)

**ì˜í–¥ì„ ë°›ì§€ ì•ŠëŠ” ì½”ë“œ**:
- ì½ê¸° ì „ìš© ì‘ì—… (ì ìˆ˜ ì¡°íšŒ, ì„ ìˆ˜ ëª©ë¡ ì¡°íšŒ ë“±)
- ì „ê´‘íŒ (ì½ê¸°ë§Œ í•¨)
- ê´€ë¦¬ì í˜ì´ì§€ (ëŒ€ë¶€ë¶„ ì½ê¸° ì‘ì—…)

**ì ì¬ì  ë¶€ì‘ìš©**:
- **ì¸ì¦ ì§€ì—°**: ì¬ì‹œë„ë¡œ ì¸í•´ ì¸ì¦ ì‹œê°„ì´ ì•½ê°„ ì¦ê°€í•  ìˆ˜ ìˆìŒ (ìµœëŒ€ 3-4ì´ˆ)
- **ë„¤íŠ¸ì›Œí¬ ë¶€í•˜**: ì¬ì‹œë„ë¡œ ì¸í•´ ë„¤íŠ¸ì›Œí¬ ìš”ì²­ì´ ì¦ê°€í•  ìˆ˜ ìˆìŒ
- **ì‚¬ìš©ì ê²½í—˜**: ì¬ì‹œë„ ì¤‘ ì‚¬ìš©ìê°€ ê¸°ë‹¤ë ¤ì•¼ í•¨ (í•˜ì§€ë§Œ ì„±ê³µë¥  í–¥ìƒ)

**ì¥ì **:
- ë„¤íŠ¸ì›Œí¬ ì¼ì‹œì  ì˜¤ë¥˜ ì‹œ ìë™ ë³µêµ¬
- ì¸ì¦ ì‹¤íŒ¨ìœ¨ ê°ì†Œ
- ì‚¬ìš©ì í¸ì˜ì„± í–¥ìƒ

---

## 3. ë°±ì¹´ìš´íŠ¸ ì½”ìŠ¤ ìˆœì„œ ê²€ì¦ ë¡œì§ ì¶”ê°€

### ğŸ“ í˜„ì¬ ìƒí™© ë¶„ì„

**í˜„ì¬ ì½”ë“œ ìœ„ì¹˜**: `src/app/scoreboard/page.tsx`

**3.1 ì½”ìŠ¤ ìˆœì„œ ì •ë ¬ (1110-1139ë²ˆ ì¤„)**
```typescript
const coursesOrder = groupData?.courses || {};
const allCoursesForGroup = [...(groupPlayers[0]?.allAssignedCourses || [])].filter(c => c && c.id !== undefined);

// ì½”ìŠ¤ ìˆœì„œëŒ€ë¡œ ì •ë ¬ (orderê°€ í° ê²ƒì´ ë§ˆì§€ë§‰)
const coursesForGroup = [...allCoursesForGroup].sort((a: any, b: any) => {
    const orderA = coursesOrder[String(a.id)];
    const orderB = coursesOrder[String(b.id)];
    
    // ê·¸ë£¹ì˜ coursesì—ì„œ ìˆœì„œ ê°€ì ¸ì˜¤ê¸°, ì—†ìœ¼ë©´ ì½”ìŠ¤ì˜ order ì‚¬ìš©
    let numA: number;
    if (typeof orderA === 'boolean') {
        numA = orderA ? (a.order || 0) : 0;
    } else if (typeof orderA === 'number' && orderA > 0) {
        numA = orderA;
    } else {
        numA = a.order || 0;  // ğŸ”¥ ë¬¸ì œ: orderê°€ ì—†ìœ¼ë©´ 0ìœ¼ë¡œ ì²˜ë¦¬
    }
    
    // ... numBë„ ë™ì¼ ...
    
    return numA - numB;
});

// ë°±ì¹´ìš´íŠ¸ëŠ” ë§ˆì§€ë§‰ ì½”ìŠ¤ë¶€í„° ì—­ìˆœì´ë¯€ë¡œ reverse
const coursesForBackcount = [...coursesForGroup].reverse();
```

**ë¬¸ì œì **:
1. `order`ê°€ ì—†ê±°ë‚˜ 0ì´ë©´ ì •ë ¬ ìˆœì„œê°€ ë¶ˆëª…í™•
2. `order` ê°’ì´ ì¤‘ë³µë˜ë©´ ì •ë ¬ ìˆœì„œê°€ ë¶ˆëª…í™•
3. ì½”ìŠ¤ ìˆœì„œ ê²€ì¦ ë¡œì§ ì—†ìŒ
4. ìˆœì„œ ì˜¤ë¥˜ ì‹œ ê²½ê³  ì—†ìŒ

### âœ… ë³´ì™„ ë°©ì•ˆ

#### ë°©ì•ˆ 3-1: ì½”ìŠ¤ ìˆœì„œ ê²€ì¦ í•¨ìˆ˜ ì¶”ê°€

**ìˆ˜ì • ìœ„ì¹˜**: `src/app/scoreboard/page.tsx` - `ExternalScoreboard` í•¨ìˆ˜ ë‚´ë¶€

**ìˆ˜ì • ë‚´ìš©**:
```typescript
// ğŸ”¥ ì¶”ê°€: ì½”ìŠ¤ ìˆœì„œ ê²€ì¦ í•¨ìˆ˜
const validateCourseOrder = (coursesForGroup: any[], coursesOrder: any, groupName: string): { isValid: boolean; warnings: string[] } => {
    const warnings: string[] = [];
    
    // 1. order ê°’ì´ ì—†ëŠ” ì½”ìŠ¤ í™•ì¸
    const coursesWithoutOrder = coursesForGroup.filter(c => {
        const order = coursesOrder[String(c.id)];
        return !order || (typeof order === 'number' && order <= 0);
    });
    
    if (coursesWithoutOrder.length > 0) {
        warnings.push(`${groupName} ê·¸ë£¹: ${coursesWithoutOrder.length}ê°œ ì½”ìŠ¤ì— ìˆœì„œ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤. (${coursesWithoutOrder.map(c => c.name || c.id).join(', ')})`);
    }
    
    // 2. order ê°’ ì¤‘ë³µ í™•ì¸
    const orderValues = coursesForGroup
        .map(c => {
            const order = coursesOrder[String(c.id)];
            if (typeof order === 'number' && order > 0) return order;
            return null;
        })
        .filter((o): o is number => o !== null);
    
    const duplicateOrders = orderValues.filter((order, index) => orderValues.indexOf(order) !== index);
    if (duplicateOrders.length > 0) {
        const uniqueDuplicates = [...new Set(duplicateOrders)];
        warnings.push(`${groupName} ê·¸ë£¹: ë‹¤ìŒ ìˆœì„œ ê°’ì´ ì¤‘ë³µë©ë‹ˆë‹¤: ${uniqueDuplicates.join(', ')}`);
    }
    
    // 3. order ê°’ì´ ì—°ì†ë˜ì§€ ì•ŠëŠ” ê²½ìš° í™•ì¸ (ì„ íƒì‚¬í•­)
    const sortedOrders = [...orderValues].sort((a, b) => a - b);
    const gaps: number[] = [];
    for (let i = 1; i < sortedOrders.length; i++) {
        if (sortedOrders[i] - sortedOrders[i - 1] > 1) {
            gaps.push(sortedOrders[i - 1], sortedOrders[i]);
        }
    }
    if (gaps.length > 0) {
        // ê²½ê³ ë§Œ í‘œì‹œ (ì˜¤ë¥˜ëŠ” ì•„ë‹˜)
        console.warn(`${groupName} ê·¸ë£¹: ì½”ìŠ¤ ìˆœì„œì— ê°„ê²©ì´ ìˆìŠµë‹ˆë‹¤.`, gaps);
    }
    
    return {
        isValid: warnings.length === 0,
        warnings
    };
};
```

#### ë°©ì•ˆ 3-2: ë°±ì¹´ìš´íŠ¸ ê³„ì‚° ì „ ì½”ìŠ¤ ìˆœì„œ ê²€ì¦

**ìˆ˜ì • ìœ„ì¹˜**: `src/app/scoreboard/page.tsx` - `processedDataByGroup` useMemo ë‚´ë¶€

**ìˆ˜ì • ë‚´ìš©**:
```typescript
const processedDataByGroup = useMemo(() => {
    // ... ê¸°ì¡´ ì½”ë“œ ...
    
    for (const groupName in groupedData) {
        const groupData = groupsData[groupName];
        const coursesOrder = groupData?.courses || {};
        const allCoursesForGroup = [...(groupPlayers[0]?.allAssignedCourses || [])].filter(c => c && c.id !== undefined);
        
        // ì½”ìŠ¤ ìˆœì„œëŒ€ë¡œ ì •ë ¬
        const coursesForGroup = [...allCoursesForGroup].sort((a: any, b: any) => {
            // ... ê¸°ì¡´ ì •ë ¬ ë¡œì§ ...
        });
        
        // ğŸ”¥ ì¶”ê°€: ì½”ìŠ¤ ìˆœì„œ ê²€ì¦
        const validation = validateCourseOrder(coursesForGroup, coursesOrder, groupName);
        if (!validation.isValid) {
            console.warn(`âš ï¸ ì½”ìŠ¤ ìˆœì„œ ê²€ì¦ ì‹¤íŒ¨ (${groupName}):`, validation.warnings);
            // ê°œë°œ í™˜ê²½ì—ì„œë§Œ ê²½ê³  í‘œì‹œ (í”„ë¡œë•ì…˜ì—ì„œëŠ” ë¡œê·¸ë§Œ)
            if (process.env.NODE_ENV === 'development') {
                validation.warnings.forEach(warning => {
                    console.warn(warning);
                });
            }
        }
        
        // ğŸ”¥ ê°œì„ : orderê°€ ì—†ëŠ” ì½”ìŠ¤ëŠ” ë’¤ë¡œ ë³´ë‚´ê¸° (ê¸°ë³¸ê°’ ì²˜ë¦¬)
        const coursesWithOrder = coursesForGroup.filter(c => {
            const order = coursesOrder[String(c.id)];
            return typeof order === 'number' && order > 0;
        });
        const coursesWithoutOrder = coursesForGroup.filter(c => {
            const order = coursesOrder[String(c.id)];
            return !order || (typeof order === 'number' && order <= 0);
        });
        
        // orderê°€ ìˆëŠ” ì½”ìŠ¤ëŠ” ì •ë ¬ëœ ìˆœì„œëŒ€ë¡œ, ì—†ëŠ” ì½”ìŠ¤ëŠ” ë’¤ë¡œ
        const finalCoursesForGroup = [...coursesWithOrder, ...coursesWithoutOrder];
        
        // ë°±ì¹´ìš´íŠ¸ëŠ” ë§ˆì§€ë§‰ ì½”ìŠ¤ë¶€í„° ì—­ìˆœì´ë¯€ë¡œ reverse
        const coursesForBackcount = [...finalCoursesForGroup].reverse();
        
        // ... ë‚˜ë¨¸ì§€ ì½”ë“œ ...
    }
    
    return rankedData;
}, [players, scores, tournament, groupsData, individualSuddenDeathData, teamSuddenDeathData]);
```

#### ë°©ì•ˆ 3-3: ê´€ë¦¬ì í˜ì´ì§€ì— ì½”ìŠ¤ ìˆœì„œ ê²€ì¦ ê¸°ëŠ¥ ì¶”ê°€ (ì„ íƒì‚¬í•­)

**ìˆ˜ì • ìœ„ì¹˜**: `src/app/admin/dashboard/page.tsx` ë˜ëŠ” ìƒˆë¡œìš´ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜

**ìˆ˜ì • ë‚´ìš©**:
- ëŒ€íšŒ ì„¤ì • í˜ì´ì§€ì—ì„œ ì½”ìŠ¤ ìˆœì„œ ê²€ì¦ ë²„íŠ¼ ì¶”ê°€
- ëª¨ë“  ê·¸ë£¹ì˜ ì½”ìŠ¤ ìˆœì„œë¥¼ ê²€ì¦í•˜ê³  ê²½ê³  í‘œì‹œ
- ìˆœì„œ ì˜¤ë¥˜ê°€ ìˆìœ¼ë©´ ìˆ˜ì • ì•ˆë‚´

### âš ï¸ ì˜í–¥ ë²”ìœ„ ë¶„ì„

**ì˜í–¥ì„ ë°›ëŠ” ì½”ë“œ**:
1. `src/app/scoreboard/page.tsx` - `processedDataByGroup` useMemo
2. ë°±ì¹´ìš´íŠ¸ ê³„ì‚° ë¡œì§ (`tieBreak` í•¨ìˆ˜ í˜¸ì¶œ ë¶€ë¶„)

**ì˜í–¥ì„ ë°›ì§€ ì•ŠëŠ” ì½”ë“œ**:
- ì ìˆ˜ ì €ì¥ ë¡œì§
- ì„ ìˆ˜ ê´€ë¦¬ ë¡œì§
- ê·¸ë£¹ ê´€ë¦¬ ë¡œì§
- ì½”ìŠ¤ ê´€ë¦¬ ë¡œì§

**ì ì¬ì  ë¶€ì‘ìš©**:
- **ì„±ëŠ¥ ì˜í–¥**: ê²€ì¦ ë¡œì§ ì¶”ê°€ë¡œ ì•½ê°„ì˜ ì„±ëŠ¥ ì €í•˜ ê°€ëŠ¥ (ë¯¸ë¯¸í•¨)
- **ì½˜ì†” ê²½ê³ **: ê°œë°œ í™˜ê²½ì—ì„œ ì½˜ì†” ê²½ê³ ê°€ ë§ì´ í‘œì‹œë  ìˆ˜ ìˆìŒ
- **ì •ë ¬ ìˆœì„œ ë³€ê²½**: orderê°€ ì—†ëŠ” ì½”ìŠ¤ê°€ ë’¤ë¡œ ì´ë™í•˜ì—¬ ê¸°ì¡´ ìˆœì„œì™€ ë‹¤ë¥¼ ìˆ˜ ìˆìŒ

**ì¥ì **:
- ë°±ì¹´ìš´íŠ¸ ê³„ì‚° ì˜¤ë¥˜ ì‚¬ì „ ë°©ì§€
- ì½”ìŠ¤ ìˆœì„œ ë¬¸ì œ ì¡°ê¸° ë°œê²¬
- ë°ì´í„° ë¬´ê²°ì„± í–¥ìƒ

---

## ì¢…í•© ì˜í–¥ ë¶„ì„

### âœ… ì•ˆì „í•œ ìˆ˜ì •

**1. ê·¸ë£¹ íƒ€ì… ì¼ì¹˜ í™•ì¸ ê°•í™”**
- **ì˜í–¥ ë²”ìœ„**: ê·¸ë£¹ ìƒì„± ë° ì„ ìˆ˜ ì—…ë¡œë“œ ê¸°ëŠ¥ë§Œ
- **ë¶€ì‘ìš©**: ì—†ìŒ (ì˜¤íˆë ¤ ë°ì´í„° ë¬´ê²°ì„± í–¥ìƒ)
- **ê¶Œì¥**: ì¦‰ì‹œ ì ìš© ê°€ëŠ¥

**2. Firebase ì¸ì¦ ì¬ì‹œë„ ë¡œì§ ê°•í™”**
- **ì˜í–¥ ë²”ìœ„**: ì ìˆ˜ ì €ì¥ ê¸°ëŠ¥ë§Œ
- **ë¶€ì‘ìš©**: ì¸ì¦ ì‹œê°„ ì•½ê°„ ì¦ê°€ (ìµœëŒ€ 3-4ì´ˆ)
- **ê¶Œì¥**: ì¦‰ì‹œ ì ìš© ê°€ëŠ¥ (ì‚¬ìš©ì ê²½í—˜ í–¥ìƒ)

**3. ë°±ì¹´ìš´íŠ¸ ì½”ìŠ¤ ìˆœì„œ ê²€ì¦ ë¡œì§ ì¶”ê°€**
- **ì˜í–¥ ë²”ìœ„**: ì „ê´‘íŒ ìˆœìœ„ ê³„ì‚°ë§Œ
- **ë¶€ì‘ìš©**: ë¯¸ë¯¸í•œ ì„±ëŠ¥ ì˜í–¥, ì½˜ì†” ê²½ê³  ì¦ê°€
- **ê¶Œì¥**: ì¦‰ì‹œ ì ìš© ê°€ëŠ¥ (ë°ì´í„° ë¬´ê²°ì„± í–¥ìƒ)

### ğŸ“‹ ìˆ˜ì • ìš°ì„ ìˆœìœ„

1. **ë†’ìŒ**: ê·¸ë£¹ íƒ€ì… ì¼ì¹˜ í™•ì¸ ê°•í™” (ë°ì´í„° ë¬´ê²°ì„±)
2. **ë†’ìŒ**: Firebase ì¸ì¦ ì¬ì‹œë„ ë¡œì§ ê°•í™” (ì‚¬ìš©ì ê²½í—˜)
3. **ì¤‘ê°„**: ë°±ì¹´ìš´íŠ¸ ì½”ìŠ¤ ìˆœì„œ ê²€ì¦ ë¡œì§ ì¶”ê°€ (ë°ì´í„° ì •í™•ì„±)

### ğŸ¯ ìµœì¢… ê¶Œì¥ ì‚¬í•­

**ëª¨ë“  ê°œì„  ì‚¬í•­ì„ ì ìš©í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.**

- ê° ê°œì„  ì‚¬í•­ì€ ë…ë¦½ì ìœ¼ë¡œ ì‘ë™
- ì„œë¡œ ê°„ì„­í•˜ì§€ ì•ŠìŒ
- ì „ì²´ì ìœ¼ë¡œ ì‹œìŠ¤í…œ ì•ˆì •ì„± í–¥ìƒ
- ì‚¬ìš©ì ê²½í—˜ ê°œì„ 

---

## ê²€í†  ì™„ë£Œ

**ê²€í† ì**: AI Assistant  
**ê²€í†  ì¼ì**: 2024ë…„  
**ê²€í†  ë²”ìœ„**: 3ê°€ì§€ ê°œì„ ì‚¬í•­ ë³´ì™„ ë°©ì•ˆ ë° ì˜í–¥ ë¶„ì„


# 코스 설정 자동 순서 확인 보고서

## 문제 상황

사용자가 보고한 문제:
- 그룹 및 선수관리에서 코스 설정을 별도로 하지 않았을 때, 대회 및 코스관리에서 생성된 코스 순서대로 기본 순서가 되어야 함
- 이미지에서는 이미 설정이 되어 있는 것처럼 보임 (첫번째 코스, 두번째 코스 등)
- 하지만 이 설정이 "풀렸다"고 함

## 코드 확인 결과

### 1. `handleOpenCourseModal` 함수 (1327-1393 라인)

**로직:**
```typescript
const handleOpenCourseModal = (group: any) => {
    setCurrentEditingGroup(group);
    const existingCourses = group.courses || {};
    const convertedCourses: {[key: string]: number} = {};
    
    // 기존 설정이 있는 코스와 없는 코스를 구분
    const coursesWithExistingOrder: Array<{courseId: string, order: number}> = [];
    const coursesWithoutOrder: Array<{courseId: string, courseOrder: number}> = [];
    
    // 모든 코스를 확인
    courses.forEach(course => {
        const courseIdStr = String(course.id);
        const existingOrder = existingCourses[courseIdStr];
        
        // 기존 설정이 있고 number 타입이고 0보다 큰 경우
        if (typeof existingOrder === 'number' && existingOrder > 0) {
            coursesWithExistingOrder.push({ courseId: courseIdStr, order: existingOrder });
        } else {
            // 기존 설정이 없거나 boolean true인 경우 → 코스의 order 값을 기본값으로 사용
            const courseOrder = course.order || 0;
            if (courseOrder > 0) {
                coursesWithoutOrder.push({ courseId: courseIdStr, courseOrder });
            } else {
                // 코스의 order도 없으면 0 (선택 안함)
                convertedCourses[courseIdStr] = 0;
            }
        }
    });
    
    // 기존 설정이 없는 코스는 코스의 order 기준으로 정렬
    coursesWithoutOrder.sort((a, b) => a.courseOrder - b.courseOrder);
    
    // 기존 설정이 없는 코스는 코스의 order를 기준으로 순차적으로 할당
    coursesWithoutOrder.forEach((item) => {
        let targetOrder = item.courseOrder;
        while (usedOrders.has(targetOrder)) {
            targetOrder++;
        }
        convertedCourses[item.courseId] = targetOrder;
        usedOrders.add(targetOrder);
    });
    
    setAssignedCourses(convertedCourses);
    setGroupCourseModalOpen(true);
};
```

**동작 방식:**
1. 기존 설정이 `number` 타입이고 0보다 크면 → 기존 order 사용
2. 기존 설정이 없거나 `boolean true`인 경우 → 코스의 `order` 값을 기본값으로 사용
3. 코스의 `order`가 없으면 → 0 (선택 안함)

### 2. 코스 데이터 로딩 확인 필요

**코스 데이터는 어디서 로드되는가?**
- `src/app/admin/players/page.tsx`에서 `courses` state가 사용됨
- `setCourses`가 호출되는 부분을 확인해야 함

### 3. 코스의 기본 order 값

**대회 및 코스 관리 페이지 (`src/app/admin/tournaments/page.tsx`):**
```typescript
const initialCourses: Course[] = [
  { id: 1, name: 'A코스', pars: [...defaultPars], isActive: true, order: 1 },
  { id: 2, name: 'B코스', pars: [...defaultPars], isActive: true, order: 2 },
];
```

**문제점:**
- A코스와 B코스의 기본 order는 1, 2로 설정됨
- 하지만 C코스와 D코스의 기본 order는 확인 필요
- 코스가 동적으로 생성될 때 `order` 값이 제대로 설정되는지 확인 필요

### 4. 시뮬레이션 도구에서 그룹 생성

**여자부 그룹 생성 시:**
```typescript
courses: { 
    [courseC.id]: true,  // boolean true만 설정
    [courseD.id]: true,  // boolean true만 설정
    [courseA.id]: true,  // boolean true만 설정
    [courseB.id]: true   // boolean true만 설정
}
```

**예상 동작:**
- `handleOpenCourseModal`이 호출되면
- 기존 설정이 boolean true이므로 → 코스의 `order` 값을 사용
- 코스의 `order`가 1, 2, 3, 4로 설정되어 있다면 → 자동으로 "첫번째 코스", "두번째 코스" 등이 선택됨

## 확인 필요 사항

### 1. 코스 데이터 로딩 확인

`src/app/admin/players/page.tsx`에서 `courses` state가 어떻게 로드되는지 확인:
- Firebase에서 코스 데이터를 가져올 때 `order` 값이 포함되는지
- 코스 데이터가 로드된 후 `order` 값이 제대로 있는지

### 2. 코스의 기본 order 값 확인

- A코스: `order: 1` ✅
- B코스: `order: 2` ✅
- C코스: `order: ?` ❓ 확인 필요
- D코스: `order: ?` ❓ 확인 필요

### 3. 코스 설정 모달 UI 확인

코스 설정 모달이 열릴 때:
- `assignedCourses` state가 제대로 설정되는지
- UI에 "첫번째 코스", "두번째 코스" 등이 표시되는지

## 가능한 원인

### 1. 코스 데이터 로딩 문제

코스 데이터를 Firebase에서 가져올 때 `order` 값이 누락되었을 수 있음:
- 코스 데이터를 저장할 때 `order` 값을 저장하지 않았을 수 있음
- 코스 데이터를 로드할 때 `order` 값을 포함하지 않았을 수 있음

### 2. 코스의 기본 order 값 누락

C코스와 D코스의 기본 `order` 값이 설정되지 않았을 수 있음:
- 코스를 생성할 때 `order` 값을 설정하지 않았을 수 있음
- 코스의 `order` 값이 0이거나 undefined일 수 있음

### 3. 코드 수정으로 인한 영향

최근 코드 수정 중에 코스 데이터 로딩 로직이 변경되었을 수 있음:
- `courses` state를 설정하는 부분이 변경되었을 수 있음
- 코스 데이터를 필터링하거나 변환하는 과정에서 `order` 값이 누락되었을 수 있음

## 권장 조치

### 1. 코스 데이터 로딩 확인

`src/app/admin/players/page.tsx`에서 코스 데이터를 로드하는 부분을 확인:
```typescript
// 코스 데이터 로딩 부분 확인
useEffect(() => {
    // 코스 데이터를 Firebase에서 가져올 때 order 값이 포함되는지 확인
    // courses state에 order 값이 제대로 설정되는지 확인
}, []);
```

### 2. 코스의 기본 order 값 확인

Firebase에서 코스 데이터를 확인:
- `tournaments/current/courses` 경로에서 각 코스의 `order` 값 확인
- C코스와 D코스의 `order` 값이 설정되어 있는지 확인

### 3. 디버깅 로그 추가

`handleOpenCourseModal` 함수에 디버깅 로그 추가:
```typescript
console.log('코스 데이터:', courses);
console.log('기존 설정:', existingCourses);
console.log('변환된 설정:', convertedCourses);
```

이를 통해 각 단계에서 데이터가 제대로 처리되는지 확인할 수 있습니다.


# 여자부 백카운트 확인 보고서

## 확인 결과

### ⚠️ 잠재적 문제 발견

#### 1. 여자부 그룹 코스 순서 설정

**시뮬레이션 도구에서 여자부 그룹 생성 시:**
```typescript
courses: { 
    [courseC.id]: true, 
    [courseD.id]: true, 
    [courseA.id]: true, 
    [courseB.id]: true 
}
```

**문제점:**
- `order` 값이 설정되지 않음 (boolean `true`만 설정)
- 코스 순서가 명시적으로 정의되지 않음

#### 2. 전광판 백카운트 계산 로직

**코스 순서 결정 로직:**
```typescript
const orderA = coursesOrder[String(a.id)];

let numA: number;
if (typeof orderA === 'boolean') {
    numA = orderA ? (a.order || 0) : 0;  // 코스의 기본 order 사용
} else if (typeof orderA === 'number' && orderA > 0) {
    numA = orderA;  // 명시적 order 사용
} else {
    numA = a.order || 0;  // 코스의 기본 order 사용
}
```

**백카운트 진행:**
```typescript
// 코스 순서대로 정렬 (order가 큰 것이 마지막)
const coursesForGroup = [...allCoursesForGroup].sort((a, b) => {
    return numA - numB; // 작은 순서가 먼저
});

// 백카운트는 마지막 코스부터 역순이므로 reverse
const coursesForBackcount = [...finalCoursesForGroup].reverse();
```

---

## 여자부 백카운트 예상 동작

### 시뮬레이션 데이터 기준

**여자부 점수 입력:**
- 1일차: C코스, D코스 점수 입력
- 2일차: A코스, B코스 점수 입력

**예상 백카운트 순서:**
1. 코스의 기본 `order` 값에 따라 결정됨
2. 만약 코스의 기본 `order`가:
   - A코스: 1
   - B코스: 2
   - C코스: 3
   - D코스: 4
   - 라면 → 정렬: A(1) → B(2) → C(3) → D(4)
   - 역순: D(4) → C(3) → B(2) → A(1) ✅ 올바름

**하지만 만약 코스의 기본 `order`가 없거나 잘못 설정되어 있다면:**
- 모든 코스가 `order: 0`이면 → 정렬 순서가 불확실
- 백카운트 계산이 올바르지 않을 수 있음

---

## 확인 필요 사항

### 1. 코스의 기본 order 값 확인

Firebase에서 코스 데이터의 `order` 값을 확인해야 합니다:
- A코스: `order` 값은?
- B코스: `order` 값은?
- C코스: `order` 값은?
- D코스: `order` 값은?

### 2. 여자부 그룹의 courses 설정 확인

Firebase에서 여자부 그룹의 `courses` 설정을 확인해야 합니다:
```json
{
  "여자부": {
    "courses": {
      "1": true,  // A코스 (order 없음)
      "2": true,  // B코스 (order 없음)
      "3": true,  // C코스 (order 없음)
      "4": true   // D코스 (order 없음)
    }
  }
}
```

**문제:** `order` 값이 없으면 코스의 기본 `order`에 의존하게 됨

---

## 권장 수정 사항

### 시뮬레이션 도구에서 여자부 그룹 생성 시 order 값 설정

```typescript
if (!groupsData[femaleGroupName]) {
    updates[`/tournaments/current/groups/${femaleGroupName}`] = {
        name: femaleGroupName,
        type: 'individual',
        courses: { 
            [courseC.id]: 1,  // C코스: order 1 (1일차 첫 번째)
            [courseD.id]: 2,  // D코스: order 2 (1일차 두 번째)
            [courseA.id]: 3,  // A코스: order 3 (2일차 첫 번째)
            [courseB.id]: 4   // B코스: order 4 (2일차 두 번째)
        }
    };
}
```

**백카운트 순서:**
- 정렬: C(1) → D(2) → A(3) → B(4)
- 역순: B(4) → A(3) → D(2) → C(1)
- **하지만 이건 잘못됨!** 백카운트는 D→C→B→A 순서여야 함

**올바른 order 설정:**
```typescript
courses: { 
    [courseA.id]: 1,  // A코스: order 1
    [courseB.id]: 2,  // B코스: order 2
    [courseC.id]: 3,  // C코스: order 3
    [courseD.id]: 4   // D코스: order 4
}
```

**백카운트 순서:**
- 정렬: A(1) → B(2) → C(3) → D(4)
- 역순: D(4) → C(3) → B(2) → A(1) ✅ 올바름

---

## 결론

### 현재 상태

1. **여자부 그룹 생성 시 `order` 값 미설정**
   - boolean `true`만 설정되어 있음
   - 코스의 기본 `order` 값에 의존

2. **백카운트 계산**
   - 코스의 기본 `order` 값이 올바르게 설정되어 있다면 정상 작동
   - 코스의 기본 `order` 값이 없거나 잘못 설정되어 있다면 백카운트가 올바르지 않을 수 있음

### 확인 방법

1. **Firebase에서 코스 데이터 확인:**
   - 각 코스의 `order` 값 확인
   - A, B, C, D 코스의 `order`가 1, 2, 3, 4로 설정되어 있는지 확인

2. **여자부 그룹의 courses 설정 확인:**
   - `tournaments/current/groups/여자부/courses` 확인
   - `order` 값이 설정되어 있는지 확인

3. **전광판에서 여자부 백카운트 확인:**
   - 동점자가 있는 경우 백카운트로 순위가 결정되는지 확인
   - 코스 순서가 D→C→B→A 순서로 진행되는지 확인

### 권장 조치

시뮬레이션 도구에서 여자부 그룹 생성 시 `order` 값을 명시적으로 설정하는 것을 권장합니다.


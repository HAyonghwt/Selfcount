# í”Œë ˆì´ì˜¤í”„ ë° ì„œë“ ë°ìŠ¤ ê¸°ëŠ¥ ê²€ì¦ ë³´ê³ ì„œ

## ê²€ì¦ ì¼ì: 2024ë…„
## ê²€ì¦ ëª©ì : í”Œë ˆì´ì˜¤í”„ ë° ì„œë“ ë°ìŠ¤ ê¸°ëŠ¥ì˜ ì „ë°˜ì ì¸ ì‘ë™ ì—¬ë¶€ ë° ì½”ë“œ ì¶©ëŒ í™•ì¸

---

## 1. 1ë“± ë™ì ì ê°ì§€ ë° ì•Œë¦¼ ê¸°ëŠ¥

### 1.1 ê´€ë¦¬ì í˜ì´ì§€ì—ì„œì˜ ë™ì ì ê°ì§€

**ìœ„ì¹˜**: `src/app/admin/dashboard/page.tsx` (1896-2100ë²ˆ ì¤„)

**êµ¬í˜„ ë‚´ìš©**:
```typescript
useEffect(() => {
    // ëª¨ë“  í”Œë ˆì´ì˜¤í”„ê°€ í•„ìš”í•œ ê·¸ë£¹ì„ ë¨¼ì € ì°¾ê¸°
    const groupsNeedingPlayoff: string[] = [];
    Object.keys(groupProgress).forEach(groupName => {
        if (groupProgress[groupName] === 100 && !notifiedSuddenDeathGroups.includes(groupName)) {
            const originalTiedFirstPlace = processedPlayersInGroup.filter((p: any) => p.rank === 1);
            
            // ì„œë“ ë°ìŠ¤/NTP/ë°±ì¹´ìš´íŠ¸ë¡œ ìˆœìœ„ê°€ ê²°ì •ë˜ì—ˆëŠ”ì§€ í™•ì¸
            // ...
            
            // ìˆœìœ„ê°€ ê²°ì •ë˜ì§€ ì•Šì•˜ìœ¼ë©´ í”Œë ˆì´ì˜¤í”„ í•„ìš”
            if (finalTiedFirstPlace.length > 1) {
                groupsNeedingPlayoff.push(groupName);
            }
        }
    });
    
    // ëª¨ë“  ê·¸ë£¹ì„ í•˜ë‚˜ì˜ ì•ˆë‚´ì°½ì— í‘œì‹œ
    if (groupsNeedingPlayoff.length > 0) {
        toast({
            title: `ğŸš¨ í”Œë ˆì´ì˜¤í”„ ê´€ë¦¬ í•„ìš” (${groupsNeedingPlayoff.length}ê°œ ê·¸ë£¹)`,
            description: description,
            action: (
                <ToastAction altText="ê´€ë¦¬í•˜ê¸°" onClick={() => router.push('/admin/suddendeath')}>
                    ê´€ë¦¬í•˜ê¸°
                </ToastAction>
            ),
            duration: 30000
        });
    }
}, [groupProgress, finalDataByGroup, processedDataByGroup, ...]);
```

**ë™ì‘ ë°©ì‹**:
1. ëª¨ë“  ê·¸ë£¹ì˜ ì§„í–‰ë¥ ì„ í™•ì¸ (`groupProgress[groupName] === 100`)
2. ê° ê·¸ë£¹ì—ì„œ 1ìœ„ ë™ì ì í™•ì¸ (`processedDataByGroup`ì—ì„œ `rank === 1`ì¸ ì„ ìˆ˜ë“¤)
3. ì„œë“ ë°ìŠ¤/NTP/ë°±ì¹´ìš´íŠ¸ë¡œ ìˆœìœ„ê°€ ì´ë¯¸ ê²°ì •ë˜ì—ˆëŠ”ì§€ í™•ì¸
4. ìˆœìœ„ê°€ ê²°ì •ë˜ì§€ ì•Šì€ ê·¸ë£¹ë“¤ì„ `groupsNeedingPlayoff` ë°°ì—´ì— ì¶”ê°€
5. í•˜ë‚˜ì˜ í† ìŠ¤íŠ¸ ì•Œë¦¼ìœ¼ë¡œ ëª¨ë“  ê·¸ë£¹ì„ ì•ˆë‚´

**âœ… ê²€ì¦ ê²°ê³¼**: 
- **ëª¨ë“  ê·¸ë£¹ì—ì„œ ë™ì ì ê°ì§€**: âœ… ì •ìƒ ì‘ë™
- **ì¤‘ë³µ ì•Œë¦¼ ë°©ì§€**: âœ… `notifiedSuddenDeathGroups`ë¡œ ì¤‘ë³µ ë°©ì§€
- **ì—¬ëŸ¬ ê·¸ë£¹ ë™ì‹œ ì²˜ë¦¬**: âœ… í•˜ë‚˜ì˜ í† ìŠ¤íŠ¸ë¡œ ëª¨ë“  ê·¸ë£¹ ì•ˆë‚´

### 1.2 í”Œë ˆì´ì˜¤í”„ ê´€ë¦¬ í˜ì´ì§€ì—ì„œì˜ ë™ì ì í‘œì‹œ

**ìœ„ì¹˜**: `src/app/admin/suddendeath/page.tsx` (286-427ë²ˆ ì¤„)

**êµ¬í˜„ ë‚´ìš©**:
```typescript
useEffect(() => {
    // ëª¨ë“  ì„ ìˆ˜ ì²˜ë¦¬ ë° ìˆœìœ„ ê³„ì‚°
    // ...
    
    // 1ìœ„ ë™ì ì í™•ì¸
    const firstPlacePlayers = playersInGroup.filter(p => p.rank === 1);
    
    if (firstPlacePlayers.length < 2) continue; // 1ìœ„ ë™ì ìê°€ 2ëª… ë¯¸ë§Œì´ë©´ ìŠ¤í‚µ
    
    // 1ìœ„ ë™ì ìë“¤ì´ ëª¨ë‘ ëª¨ë“  ì½”ìŠ¤ë¥¼ ì™„ë£Œí–ˆëŠ”ì§€ í™•ì¸
    const allFirstPlaceCompleted = firstPlacePlayers.every((player: any) => {
        // ëª¨ë“  ì½”ìŠ¤ì˜ ëª¨ë“  í™€ì— ì ìˆ˜ê°€ ìˆëŠ”ì§€ í™•ì¸
        return assignedCourseIds.every((courseId: string) => {
            const courseScores = player.detailedScores[courseId] || {};
            for (let i = 1; i <= 9; i++) {
                const holeScore = courseScores[i.toString()];
                if (holeScore === undefined || holeScore === null) {
                    return false;
                }
            }
            return true;
        });
    });
    
    // Only include groups where all first-place tied players have completed all courses
    if (!allFirstPlaceCompleted) continue;
    
    if (firstPlacePlayers[0].type === 'individual') {
        individualTies.push(...firstPlacePlayers);
    } else if (firstPlacePlayers[0].type === 'team') {
        teamTies.push(...firstPlacePlayers);
    }
}, [players, scores, courses, groupsData]);
```

**ë™ì‘ ë°©ì‹**:
1. ëª¨ë“  ì„ ìˆ˜ë¥¼ ì²˜ë¦¬í•˜ì—¬ ìˆœìœ„ ê³„ì‚°
2. ê° ê·¸ë£¹ì—ì„œ 1ìœ„ ë™ì ì í™•ì¸
3. 1ìœ„ ë™ì ìë“¤ì´ ëª¨ë“  ì½”ìŠ¤ë¥¼ ì™„ë£Œí–ˆëŠ”ì§€ í™•ì¸
4. ì™„ë£Œëœ ê·¸ë£¹ë§Œ `individualTies` ë˜ëŠ” `teamTies`ì— ì¶”ê°€

**âœ… ê²€ì¦ ê²°ê³¼**: 
- **1ìœ„ ë™ì ì ê°ì§€**: âœ… ì •ìƒ ì‘ë™
- **ì½”ìŠ¤ ì™„ë£Œ í™•ì¸**: âœ… ëª¨ë“  ì½”ìŠ¤ ì™„ë£Œ í›„ì—ë§Œ í‘œì‹œ
- **ê°œì¸ì „/íŒ€ì „ êµ¬ë¶„**: âœ… ì •ìƒ ì‘ë™

---

## 2. ë°±ì¹´ìš´íŠ¸ ì ìš© ê¸°ëŠ¥

### 2.1 ë°±ì¹´ìš´íŠ¸ ì ìš© ë²„íŠ¼

**ìœ„ì¹˜**: `src/app/admin/suddendeath/page.tsx` (523-570ë²ˆ ì¤„)

**êµ¬í˜„ ë‚´ìš©**:
```typescript
const handleApplyBackcount = (type: 'individual' | 'team', groupName: string) => {
    const backcountState = type === 'individual' ? individualBackcountApplied : teamBackcountApplied;
    const setBackcountState = type === 'individual' ? setIndividualBackcountApplied : setTeamBackcountApplied;
    
    const updated = { ...backcountState, [groupName]: true };
    setBackcountState(updated);
    
    // Firebaseì— ê·¸ë£¹ë³„ ë°±ì¹´ìš´íŠ¸ ì ìš© ìƒíƒœ ì €ì¥
    set(ref(db, `tournaments/current/backcountApplied/${type}`), updated)
        .then(() => {
            toast({ title: "ë°±ì¹´ìš´íŠ¸ ì ìš©", description: `${groupName} ê·¸ë£¹ì˜ 1ìœ„ ë™ì ìê°€ ë°±ì¹´ìš´íŠ¸ë¡œ ê²°ì •ë˜ì—ˆìŠµë‹ˆë‹¤.` });
        })
        .catch(err => toast({ title: "ì˜¤ë¥˜", description: err.message }));
};
```

**âœ… ê²€ì¦ ê²°ê³¼**: 
- **ë°±ì¹´ìš´íŠ¸ ì ìš©**: âœ… ì •ìƒ ì‘ë™
- **Firebase ì €ì¥**: âœ… ì •ìƒ ì‘ë™
- **ê·¸ë£¹ë³„ ì ìš©**: âœ… ì •ìƒ ì‘ë™

### 2.2 ë°±ì¹´ìš´íŠ¸ ê³„ì‚° ë¡œì§

**ìœ„ì¹˜**: `src/app/admin/suddendeath/page.tsx` (128-163ë²ˆ ì¤„)

**êµ¬í˜„ ë‚´ìš©**:
```typescript
const backcountBreak = (a: any, b: any, coursesForGroup: any[]) => {
    // Backcount: Start from the last course and work backwards
    const sortedCourses = [...coursesForGroup].sort((c1, c2) => {
        const name1 = c1?.name || '';
        const name2 = c2?.name || '';
        return name2.localeCompare(name1);
    });
    
    for (const course of sortedCourses) {
        const courseId = course.id;
        const aCourseScore = a.courseScores[courseId] || 0;
        const bCourseScore = b.courseScores[courseId] || 0;
        if (aCourseScore !== bCourseScore) return aCourseScore - bCourseScore;
    }
    
    // If all courses are tied, compare holes from last hole to first hole
    if (sortedCourses.length > 0) {
        const lastCourseId = sortedCourses[0].id;
        const aHoleScores = a.detailedScores[lastCourseId] || {};
        const bHoleScores = b.detailedScores[lastCourseId] || {};
        for (let i = 9; i >= 1; i--) {
            const hole = i.toString();
            const aHole = aHoleScores[hole] || 0;
            const bHole = bHoleScores[hole] || 0;
            if (aHole !== bHole) return aHole - bHole;
        }
    }
    return 0;
};
```

**ë™ì‘ ë°©ì‹**:
1. ì½”ìŠ¤ ì´ë¦„ ê¸°ì¤€ ì—­ìˆœ ì •ë ¬ (ë§ˆì§€ë§‰ ì½”ìŠ¤ë¶€í„°)
2. ë§ˆì§€ë§‰ ì½”ìŠ¤ë¶€í„° ì—­ìˆœìœ¼ë¡œ ì½”ìŠ¤ ì ìˆ˜ ë¹„êµ
3. ëª¨ë“  ì½”ìŠ¤ê°€ ê°™ìœ¼ë©´ ë§ˆì§€ë§‰ ì½”ìŠ¤ì˜ í™€ ì ìˆ˜ë¥¼ ì—­ìˆœìœ¼ë¡œ ë¹„êµ (9í™€ â†’ 1í™€)

**âœ… ê²€ì¦ ê²°ê³¼**: 
- **ë°±ì¹´ìš´íŠ¸ ê³„ì‚°**: âœ… ì •ìƒ ì‘ë™
- **ì½”ìŠ¤ ìˆœì„œ**: âœ… ë§ˆì§€ë§‰ ì½”ìŠ¤ë¶€í„° ì—­ìˆœ ë¹„êµ
- **í™€ ìˆœì„œ**: âœ… ë§ˆì§€ë§‰ í™€ë¶€í„° ì—­ìˆœ ë¹„êµ

### 2.3 ì „ê´‘íŒì—ì„œì˜ ë°±ì¹´ìš´íŠ¸ ì ìš©

**ìœ„ì¹˜**: `src/app/scoreboard/page.tsx` (1402-1507ë²ˆ ì¤„)

**êµ¬í˜„ ë‚´ìš©**:
```typescript
} else if (shouldApplyBackcount) {
    // í”Œë ˆì´ì˜¤í”„ ë°±ì¹´ìš´íŠ¸: ì½”ìŠ¤ ìˆœì„œ ê¸°ë°˜ìœ¼ë¡œ ë§ˆì§€ë§‰ ì½”ìŠ¤ë¶€í„° ì—­ìˆœìœ¼ë¡œ ë¹„êµ
    const groupName = firstPlacePlayers[0]?.group;
    const groupData = groupsData[groupName];
    const coursesOrder = groupData?.courses || {};
    const allCoursesForGroup = firstPlacePlayers[0]?.allAssignedCourses || allCourses;
    
    // ì½”ìŠ¤ ìˆœì„œëŒ€ë¡œ ì •ë ¬ (orderê°€ í° ê²ƒì´ ë§ˆì§€ë§‰)
    const coursesForGroup = [...allCoursesForGroup].sort((a: any, b: any) => {
        // order ê°’ì— ë”°ë¼ ì •ë ¬
        return numA - numB; // ì‘ì€ ìˆœì„œê°€ ë¨¼ì €
    });
    
    // ë°±ì¹´ìš´íŠ¸ëŠ” ë§ˆì§€ë§‰ ì½”ìŠ¤ë¶€í„° ì—­ìˆœì´ë¯€ë¡œ reverse
    const sortedCoursesForBackcount = [...coursesForGroup].reverse();
    
    firstPlacePlayers.sort((a: any, b: any) => {
        if (a.plusMinus !== b.plusMinus) return a.plusMinus - b.plusMinus;
        // ë°±ì¹´ìš´íŠ¸: ë§ˆì§€ë§‰ ì½”ìŠ¤ë¶€í„° ì—­ìˆœìœ¼ë¡œ ë¹„êµ
        for (const course of sortedCoursesForBackcount) {
            // ì½”ìŠ¤ ì ìˆ˜ ë¹„êµ
        }
        // í™€ ì ìˆ˜ ì—­ìˆœ ë¹„êµ
    });
    
    // ìƒˆë¡œìš´ ìˆœìœ„ ë¶€ì—¬
    let rank = 1;
    firstPlacePlayers[0].rank = rank;
    for (let i = 1; i < firstPlacePlayers.length; i++) {
        // ìˆœìœ„ ë¶€ì—¬ ë¡œì§
    }
}
```

**âœ… ê²€ì¦ ê²°ê³¼**: 
- **ë°±ì¹´ìš´íŠ¸ ì ìš©**: âœ… ì •ìƒ ì‘ë™
- **ì½”ìŠ¤ ìˆœì„œ**: âœ… ê·¸ë£¹ì˜ `courses` ì„¤ì •ì—ì„œ `order` ê°’ ì‚¬ìš©
- **ìˆœìœ„ ë¶€ì—¬**: âœ… ì •ìƒ ì‘ë™

---

## 3. ì„œë“ ë°ìŠ¤ ê¸°ëŠ¥

### 3.1 ì„œë“ ë°ìŠ¤ ì‹œì‘

**ìœ„ì¹˜**: `src/app/admin/suddendeath/page.tsx` (429-494ë²ˆ ì¤„)

**êµ¬í˜„ ë‚´ìš©**:
```typescript
const handleStartSuddenDeath = (type: 'individual' | 'team', groupName?: string) => {
    const courseId = isIndividual ? selectedIndividualCourseId : selectedTeamCourseId;
    const holes = isIndividual ? selectedIndividualHoles : selectedTeamHoles;
    
    const suddenDeathSetup = {
        isActive: true,
        players: playersToSave,
        courseId: courseId,
        holes: holes.sort((a,b) => a - b),
        scores: {},
    };
    
    // Save group-specific sudden death
    const currentData = isIndividual ? individualSuddenDeathData : teamSuddenDeathData;
    const updatedData = { ...currentData, [groupName]: suddenDeathSetup };
    
    set(ref(db, `tournaments/current/suddenDeath/${type}`), updatedData)
        .then(() => toast({ title: "ì„±ê³µ", description: `${groupName} ê·¸ë£¹ ${isIndividual ? 'ê°œì¸ì „' : '2ì¸ 1íŒ€'} ì„œë“ ë°ìŠ¤-í”Œë ˆì´ì˜¤í”„ê°€ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.` }))
        .catch(err => toast({ title: "ì˜¤ë¥˜", description: err.message }));
};
```

**âœ… ê²€ì¦ ê²°ê³¼**: 
- **ì„œë“ ë°ìŠ¤ ì‹œì‘**: âœ… ì •ìƒ ì‘ë™
- **ì½”ìŠ¤ ì„¤ì •**: âœ… ì„ íƒí•œ ì½”ìŠ¤ ì €ì¥
- **í™€ ì„¤ì •**: âœ… ì„ íƒí•œ í™€ë“¤ ì €ì¥ ë° ì •ë ¬
- **ê·¸ë£¹ë³„ ì €ì¥**: âœ… ê·¸ë£¹ë³„ë¡œ ë¶„ë¦¬ ì €ì¥

### 3.2 ì„œë“ ë°ìŠ¤ ì ìˆ˜ ì…ë ¥

**ìœ„ì¹˜**: `src/app/admin/suddendeath/page.tsx` (736-762ë²ˆ ì¤„)

**êµ¬í˜„ ë‚´ìš©**:
```typescript
const handleSuddenDeathScoreChange = (type: 'individual' | 'team', playerId: string, hole: number, value: string, groupName: string) => {
    const scoreRef = ref(db, `tournaments/current/suddenDeath/${type}/${groupName}/scores/${playerId}/${hole}`);
    const numericValue = parseInt(value, 10);
    if (!isNaN(numericValue)) {
        set(scoreRef, numericValue);
    } else if (value === '') {
        remove(scoreRef);
    }
};
```

**âœ… ê²€ì¦ ê²°ê³¼**: 
- **ì ìˆ˜ ì…ë ¥**: âœ… ì‹¤ì‹œê°„ Firebase ì €ì¥
- **ì ìˆ˜ ì‚­ì œ**: âœ… ë¹ˆ ê°’ ì…ë ¥ ì‹œ ì‚­ì œ

### 3.3 ì„œë“ ë°ìŠ¤ ìˆœìœ„ ê³„ì‚°

**ìœ„ì¹˜**: `src/app/admin/suddendeath/page.tsx` (764-809ë²ˆ ì¤„)

**êµ¬í˜„ ë‚´ìš©**:
```typescript
const processSuddenDeathData = (suddenDeathData: Partial<SuddenDeathData> | null) => {
    // ...
    
    results.sort((a, b) => {
        if (a.holesPlayed !== b.holesPlayed) return b.holesPlayed - a.holesPlayed;
        if (a.totalScore !== b.totalScore) return a.totalScore - b.totalScore;
        return a.name.localeCompare(b.name);
    });
    
    let rank = 1;
    for (let i = 0; i < results.length; i++) {
        if (i > 0 && (results[i].totalScore > results[i-1].totalScore || results[i].holesPlayed < results[i-1].holesPlayed)) {
            rank = i + 1;
        }
        results[i].rank = rank;
    }
    
    return results;
};
```

**ë™ì‘ ë°©ì‹**:
1. í™€ í”Œë ˆì´ ìˆ˜ ê¸°ì¤€ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬
2. ì´ì  ê¸°ì¤€ ì˜¤ë¦„ì°¨ìˆœ ì •ë ¬
3. ì´ë¦„ ê¸°ì¤€ ì˜¤ë¦„ì°¨ìˆœ ì •ë ¬
4. ìˆœìœ„ ë¶€ì—¬ (ë™ì ìëŠ” ê°™ì€ ìˆœìœ„)

**âœ… ê²€ì¦ ê²°ê³¼**: 
- **ìˆœìœ„ ê³„ì‚°**: âœ… ì •ìƒ ì‘ë™
- **ë™ì  ì²˜ë¦¬**: âœ… ë™ì ìëŠ” ê°™ì€ ìˆœìœ„ ë¶€ì—¬

### 3.4 ì™¸ë¶€ ì „ê´‘íŒì—ì„œì˜ ì„œë“ ë°ìŠ¤ í‘œì‹œ

**ìœ„ì¹˜**: `src/app/scoreboard/page.tsx` (1944-2000ë²ˆ ì¤„, 2040-2045ë²ˆ ì¤„)

**êµ¬í˜„ ë‚´ìš©**:
```typescript
const SuddenDeathTable = ({ type, data, processedData }: { type: 'individual' | 'team', data: any, processedData: any[] }) => {
    const title = type === 'individual' ? t('suddenDeathIndividual') : t('suddenDeathTeam');
    const courseName = data?.courseId && tournament?.courses?.[data.courseId]?.name;
    
    return (
        <div className="mb-6">
            <header className="flex flex-col justify-center items-center sb-group-header pb-2 mb-2 text-center">
                <h1 className="text-2xl md:text-4xl font-bold sb-title flex items-center gap-3">
                    <Flame className="h-8 w-8 animate-pulse" />
                    {title}
                    <Flame className="h-8 w-8 animate-pulse" />
                </h1>
                {courseName && (
                    <p className="text-lg md:text-xl font-semibold text-gray-400 mt-1">
                        ({courseName})
                    </p>
                )}
            </header>
            {/* ì„œë“ ë°ìŠ¤ í…Œì´ë¸” */}
        </div>
    );
};

// ë Œë”ë§
{individualSuddenDeathData?.isActive && (
    <SuddenDeathTable type="individual" data={individualSuddenDeathData} processedData={processedIndividualSuddenDeathData} />
)}
{teamSuddenDeathData?.isActive && (
    <SuddenDeathTable type="team" data={teamSuddenDeathData} processedData={processedTeamSuddenDeathData} />
)}
```

**âœ… ê²€ì¦ ê²°ê³¼**: 
- **ì„œë“ ë°ìŠ¤ ì°½ í‘œì‹œ**: âœ… ì •ìƒ ì‘ë™
- **ì½”ìŠ¤ ì´ë¦„ í‘œì‹œ**: âœ… ì •ìƒ ì‘ë™
- **ê°œì¸ì „/íŒ€ì „ êµ¬ë¶„**: âœ… ì •ìƒ ì‘ë™
- **ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸**: âœ… Firebase ë¦¬ìŠ¤ë„ˆë¡œ ì‹¤ì‹œê°„ ë°˜ì˜

### 3.5 ì„œë“ ë°ìŠ¤ ê²°ê³¼ ì „ê´‘íŒ ë°˜ì˜

**ìœ„ì¹˜**: `src/app/scoreboard/page.tsx` (1530-1564ë²ˆ ì¤„)

**êµ¬í˜„ ë‚´ìš©**:
```typescript
const finalDataByGroup = useMemo(() => {
    const individualRankMap = new Map(processedIndividualSuddenDeathData.map(p => [p.id, p.rank]));
    const teamRankMap = new Map(processedTeamSuddenDeathData.map(p => [p.id, p.rank]));
    const combinedRankMap = new Map([...individualRankMap, ...teamRankMap]);
    
    let finalData = processedDataByGroup;
    
    // ì„œë“ ë°ìŠ¤ ìˆœìœ„ê°€ ìˆëŠ” ê²½ìš° ì ìš©
    if (combinedRankMap.size > 0) {
        finalData = JSON.parse(JSON.stringify(processedDataByGroup));
        
        for (const groupName in finalData) {
            finalData[groupName].forEach((player: ProcessedPlayer) => {
                if (combinedRankMap.has(player.id)) {
                    player.rank = combinedRankMap.get(player.id) as number;
                }
            });
            
            finalData[groupName].sort((a: any, b: any) => {
                const rankA = a.rank === null ? Infinity : a.rank;
                const rankB = b.rank === null ? Infinity : b.rank;
                if (rankA !== rankB) return rankA - rankB;
                // ...
            })
        }
    }
    
    // ë°±ì¹´ìš´íŠ¸/NTP ì ìš©
    finalData = applyPlayoffRanking(finalData);
    
    return finalData;
}, [processedDataByGroup, processedIndividualSuddenDeathData, processedTeamSuddenDeathData, ...]);
```

**âœ… ê²€ì¦ ê²°ê³¼**: 
- **ì„œë“ ë°ìŠ¤ ìˆœìœ„ ë°˜ì˜**: âœ… ì •ìƒ ì‘ë™
- **ì „ê´‘íŒ ì—…ë°ì´íŠ¸**: âœ… ì‹¤ì‹œê°„ ë°˜ì˜
- **ìˆœìœ„ ì •ë ¬**: âœ… ì •ìƒ ì‘ë™

---

## 4. ë‹ˆì–´ë¦¬ìŠ¤íŠ¸ íˆ¬ ë” í•€ (NTP) ê¸°ëŠ¥

### 4.1 NTP ì‹œì‘

**ìœ„ì¹˜**: `src/app/admin/suddendeath/page.tsx` (572-639ë²ˆ ì¤„)

**êµ¬í˜„ ë‚´ìš©**:
```typescript
const handleStartNTP = (type: 'individual' | 'team', groupName?: string) => {
    // ì´ˆê¸° ìˆœìœ„ ì„¤ì • (ì„ íƒëœ ìˆœì„œëŒ€ë¡œ 1, 2, 3...)
    const initialRankings: { [key: string]: number } = {};
    activePlayers.forEach((playerId, index) => {
        initialRankings[playerId] = index + 1;
    });
    
    const ntpSetup: NTPData = {
        isActive: true,
        players: playersToSave,
        rankings: initialRankings,
    };
    
    // Save group-specific NTP
    const currentData = isIndividual ? individualNTPData : teamNTPData;
    const updatedData = { ...currentData, [groupName]: ntpSetup };
    
    set(ref(db, `tournaments/current/nearestToPin/${type}`), updatedData)
        .then(() => {
            toast({ title: "ì„±ê³µ", description: `${groupName} ê·¸ë£¹ ${isIndividual ? 'ê°œì¸ì „' : '2ì¸ 1íŒ€'} ë‹ˆì–´ë¦¬ìŠ¤íŠ¸ íˆ¬ ë” í•€ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.` });
        })
        .catch(err => toast({ title: "ì˜¤ë¥˜", description: err.message }));
};
```

**âœ… ê²€ì¦ ê²°ê³¼**: 
- **NTP ì‹œì‘**: âœ… ì •ìƒ ì‘ë™
- **ì´ˆê¸° ìˆœìœ„**: âœ… ì„ íƒëœ ìˆœì„œëŒ€ë¡œ 1, 2, 3... ë¶€ì—¬
- **ê·¸ë£¹ë³„ ì €ì¥**: âœ… ê·¸ë£¹ë³„ë¡œ ë¶„ë¦¬ ì €ì¥

### 4.2 NTP ìˆœìœ„ ë³€ê²½

**ìœ„ì¹˜**: `src/app/admin/suddendeath/page.tsx` (686-734ë²ˆ ì¤„)

**êµ¬í˜„ ë‚´ìš©**:
```typescript
const handleNTPRankChange = (type: 'individual' | 'team', playerId: string, newRank: number, groupName: string) => {
    // ê°™ì€ ìˆœìœ„ê°€ ìˆëŠ”ì§€ í™•ì¸
    const existingPlayerWithRank = Object.entries(currentRankings).find(([pid, rank]) => pid !== playerId && rank === newRank);
    
    let updatedRankings: { [key: string]: number };
    if (existingPlayerWithRank) {
        // ê¸°ì¡´ ìˆœìœ„ë¥¼ êµí™˜
        const [otherPlayerId, otherRank] = existingPlayerWithRank;
        const currentPlayerRank = currentRankings[playerId] || 0;
        
        updatedRankings = { ...currentRankings };
        updatedRankings[playerId] = newRank;
        updatedRankings[otherPlayerId] = currentPlayerRank;
    } else {
        // ë‹¨ìˆœ ìˆœìœ„ ë³€ê²½
        updatedRankings = { ...currentRankings, [playerId]: newRank };
    }
    
    // Firebase ì—…ë°ì´íŠ¸
    if (db && ntpData?.isActive) {
        const updatedNTPData = { ...allNTPData, [groupName]: { ...ntpData, rankings: updatedRankings } };
        set(ref(db, `tournaments/current/nearestToPin/${type}`), updatedNTPData)
            .catch(err => toast({ title: "ì˜¤ë¥˜", description: err.message }));
    }
};
```

**âœ… ê²€ì¦ ê²°ê³¼**: 
- **ìˆœìœ„ ë³€ê²½**: âœ… ì •ìƒ ì‘ë™
- **ìˆœìœ„ êµí™˜**: âœ… ê°™ì€ ìˆœìœ„ ì„ íƒ ì‹œ ìë™ êµí™˜
- **Firebase ì €ì¥**: âœ… ì‹¤ì‹œê°„ ì €ì¥

### 4.3 NTP ìˆœìœ„ ì „ê´‘íŒ ë°˜ì˜

**ìœ„ì¹˜**: `src/app/scoreboard/page.tsx` (1383-1401ë²ˆ ì¤„)

**êµ¬í˜„ ë‚´ìš©**:
```typescript
if (shouldApplyNTP) {
    // NTP ìˆœìœ„ ì ìš©
    const ntpRankings = ntpData.rankings;
    firstPlacePlayers.forEach((player: any) => {
        if (ntpRankings[player.id]) {
            player.rank = ntpRankings[player.id];
        }
    });
    
    // ì „ì²´ ê·¸ë£¹ì„ ë‹¤ì‹œ ì •ë ¬
    groupPlayers.sort((a: any, b: any) => {
        const rankA = a.rank === null ? Infinity : a.rank;
        const rankB = b.rank === null ? Infinity : b.rank;
        if (rankA !== rankB) return rankA - rankB;
        // ...
    });
}
```

**âœ… ê²€ì¦ ê²°ê³¼**: 
- **NTP ìˆœìœ„ ë°˜ì˜**: âœ… ì •ìƒ ì‘ë™
- **ì „ê´‘íŒ ì—…ë°ì´íŠ¸**: âœ… ì‹¤ì‹œê°„ ë°˜ì˜
- **ìˆœìœ„ ì •ë ¬**: âœ… ì •ìƒ ì‘ë™

---

## 5. ì„œë“ ë°ìŠ¤ì—ì„œ ë™ì ì ë°œìƒ ì‹œ ì²˜ë¦¬

### 5.1 ì„œë“ ë°ìŠ¤ ë™ì ì ì²˜ë¦¬

**ìœ„ì¹˜**: `src/app/admin/suddendeath/page.tsx` (794-806ë²ˆ ì¤„)

**êµ¬í˜„ ë‚´ìš©**:
```typescript
results.sort((a, b) => {
    if (a.holesPlayed !== b.holesPlayed) return b.holesPlayed - a.holesPlayed;
    if (a.totalScore !== b.totalScore) return a.totalScore - b.totalScore;
    return a.name.localeCompare(b.name);
});

let rank = 1;
for (let i = 0; i < results.length; i++) {
    if (i > 0 && (results[i].totalScore > results[i-1].totalScore || results[i].holesPlayed < results[i-1].holesPlayed)) {
        rank = i + 1;
    }
    results[i].rank = rank;
}
```

**ë™ì‘ ë°©ì‹**:
- ë™ì ìëŠ” ê°™ì€ ìˆœìœ„ ë¶€ì—¬
- ê´€ë¦¬ìê°€ NTPë¡œ ìˆœìœ„ ê²°ì • ê°€ëŠ¥

**âœ… ê²€ì¦ ê²°ê³¼**: 
- **ë™ì ì ì²˜ë¦¬**: âœ… ë™ì ìëŠ” ê°™ì€ ìˆœìœ„ ë¶€ì—¬
- **NTPë¡œ ê²°ì •**: âœ… NTP ê¸°ëŠ¥ìœ¼ë¡œ ìˆœìœ„ ê²°ì • ê°€ëŠ¥

---

## 6. ê´€ë¦¬ì ìˆœìœ„ ì„ íƒ ë° ì „ê´‘íŒ ë°˜ì˜

### 6.1 NTP ìˆœìœ„ ì„ íƒ

**ìœ„ì¹˜**: `src/app/admin/suddendeath/page.tsx` (1561-1605ë²ˆ ì¤„)

**êµ¬í˜„ ë‚´ìš©**:
```typescript
<Input
    type="number"
    min={1}
    max={groupNTPPlayers.length}
    value={player.ntpRank}
    onChange={(e) => {
        const newRank = parseInt(e.target.value, 10);
        if (!isNaN(newRank) && newRank >= 1 && newRank <= groupNTPPlayers.length) {
            handleNTPRankChange(type, player.id, newRank, groupName);
        }
    }}
/>
```

**âœ… ê²€ì¦ ê²°ê³¼**: 
- **ìˆœìœ„ ì„ íƒ**: âœ… ì§ì ‘ ì…ë ¥ ë˜ëŠ” í™”ì‚´í‘œ ë²„íŠ¼ìœ¼ë¡œ ë³€ê²½ ê°€ëŠ¥
- **Firebase ì €ì¥**: âœ… ì‹¤ì‹œê°„ ì €ì¥
- **ì „ê´‘íŒ ë°˜ì˜**: âœ… ì‹¤ì‹œê°„ ë°˜ì˜

### 6.2 ì „ê´‘íŒ ìˆœìœ„ ë°˜ì˜ í™•ì¸

**ìœ„ì¹˜**: `src/app/scoreboard/page.tsx` (1357-1564ë²ˆ ì¤„)

**êµ¬í˜„ ë‚´ìš©**:
```typescript
const applyPlayoffRanking = (data: any) => {
    // NTP ìˆœìœ„ ì ìš©
    if (shouldApplyNTP) {
        const ntpRankings = ntpData.rankings;
        firstPlacePlayers.forEach((player: any) => {
            if (ntpRankings[player.id]) {
                player.rank = ntpRankings[player.id];
            }
        });
    }
    // ...
};

const finalDataByGroup = useMemo(() => {
    // ì„œë“ ë°ìŠ¤ ìˆœìœ„ ì ìš©
    // ...
    
    // ë°±ì¹´ìš´íŠ¸/NTP ì ìš©
    finalData = applyPlayoffRanking(finalData);
    
    return finalData;
}, [processedDataByGroup, processedIndividualSuddenDeathData, processedTeamSuddenDeathData, individualBackcountApplied, teamBackcountApplied, individualNTPData, teamNTPData, tournament.courses]);
```

**âœ… ê²€ì¦ ê²°ê³¼**: 
- **ìˆœìœ„ ë°˜ì˜**: âœ… ì •ìƒ ì‘ë™
- **ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸**: âœ… Firebase ë¦¬ìŠ¤ë„ˆë¡œ ì‹¤ì‹œê°„ ë°˜ì˜
- **ìˆœìœ„ ì •ë ¬**: âœ… ì •ìƒ ì‘ë™

---

## 7. ì½”ë“œ ì¶©ëŒ ë° ì˜í–¥ ë¶„ì„

### 7.1 ë°ì´í„° êµ¬ì¡°

**Firebase ê²½ë¡œ**:
- ì„œë“ ë°ìŠ¤: `tournaments/current/suddenDeath/{individual|team}/{groupName}`
- ë°±ì¹´ìš´íŠ¸: `tournaments/current/backcountApplied/{individual|team}/{groupName}`
- NTP: `tournaments/current/nearestToPin/{individual|team}/{groupName}`

**âœ… ê²€ì¦ ê²°ê³¼**: 
- **ê²½ë¡œ ë¶„ë¦¬**: âœ… ê°œì¸ì „/íŒ€ì „, ê·¸ë£¹ë³„ë¡œ ì™„ì „íˆ ë¶„ë¦¬
- **ì¶©ëŒ ì—†ìŒ**: âœ… ê° ê¸°ëŠ¥ì´ ë…ë¦½ì ìœ¼ë¡œ ì‘ë™

### 7.2 ìƒíƒœ ê´€ë¦¬

**ê´€ë¦¬ì í˜ì´ì§€**:
- `individualSuddenDeathData`, `teamSuddenDeathData`: ê·¸ë£¹ë³„ ì„œë“ ë°ìŠ¤ ë°ì´í„°
- `individualBackcountApplied`, `teamBackcountApplied`: ê·¸ë£¹ë³„ ë°±ì¹´ìš´íŠ¸ ì ìš© ìƒíƒœ
- `individualNTPData`, `teamNTPData`: ê·¸ë£¹ë³„ NTP ë°ì´í„°

**ì „ê´‘íŒ í˜ì´ì§€**:
- ë™ì¼í•œ Firebase ê²½ë¡œë¥¼ êµ¬ë…í•˜ì—¬ ì‹¤ì‹œê°„ ë™ê¸°í™”

**âœ… ê²€ì¦ ê²°ê³¼**: 
- **ìƒíƒœ ë™ê¸°í™”**: âœ… Firebaseë¥¼ í†µí•œ ì‹¤ì‹œê°„ ë™ê¸°í™”
- **ì¶©ëŒ ì—†ìŒ**: âœ… ê° ìƒíƒœê°€ ë…ë¦½ì ìœ¼ë¡œ ê´€ë¦¬ë¨

### 7.3 ìˆœìœ„ ê³„ì‚° ìš°ì„ ìˆœìœ„

**ìš°ì„ ìˆœìœ„**:
1. ì„œë“ ë°ìŠ¤ ìˆœìœ„ (ê°€ì¥ ë†’ìŒ)
2. NTP ìˆœìœ„
3. ë°±ì¹´ìš´íŠ¸ ìˆœìœ„
4. ê¸°ë³¸ ìˆœìœ„

**ìœ„ì¹˜**: `src/app/scoreboard/page.tsx` (1530-1564ë²ˆ ì¤„)

**êµ¬í˜„ ë‚´ìš©**:
```typescript
const finalDataByGroup = useMemo(() => {
    // 1. ì„œë“ ë°ìŠ¤ ìˆœìœ„ ì ìš©
    if (combinedRankMap.size > 0) {
        // ì„œë“ ë°ìŠ¤ ìˆœìœ„ë¡œ ë®ì–´ì“°ê¸°
    }
    
    // 2. ë°±ì¹´ìš´íŠ¸/NTP ì ìš© (applyPlayoffRanking ë‚´ë¶€ì—ì„œ ìš°ì„ ìˆœìœ„ ì²˜ë¦¬)
    finalData = applyPlayoffRanking(finalData);
    
    return finalData;
}, [...]);
```

**âœ… ê²€ì¦ ê²°ê³¼**: 
- **ìš°ì„ ìˆœìœ„**: âœ… ì„œë“ ë°ìŠ¤ > NTP > ë°±ì¹´ìš´íŠ¸ ìˆœì„œë¡œ ì ìš©
- **ì¶©ëŒ ì—†ìŒ**: âœ… ìš°ì„ ìˆœìœ„ì— ë”°ë¼ ì •í™•íˆ ì ìš©ë¨

### 7.4 ë‹¤ë¥¸ ê¸°ëŠ¥ì— ëŒ€í•œ ì˜í–¥

**ì ìˆ˜ ì…ë ¥ ê¸°ëŠ¥**:
- ì„œë“ ë°ìŠ¤ ì ìˆ˜ëŠ” ë³„ë„ ê²½ë¡œì— ì €ì¥ (`tournaments/current/suddenDeath/...`)
- ì¼ë°˜ ì ìˆ˜ì™€ ì™„ì „íˆ ë¶„ë¦¬

**ìˆœìœ„ ê³„ì‚° ê¸°ëŠ¥**:
- `applyPlayoffRanking` í•¨ìˆ˜ë¡œ í”Œë ˆì´ì˜¤í”„ ìˆœìœ„ë§Œ ì ìš©
- ê¸°ë³¸ ìˆœìœ„ ê³„ì‚° ë¡œì§ê³¼ ë¶„ë¦¬

**ì „ê´‘íŒ í‘œì‹œ ê¸°ëŠ¥**:
- ì„œë“ ë°ìŠ¤ í…Œì´ë¸”ì€ ë³„ë„ ì»´í¬ë„ŒíŠ¸ë¡œ í‘œì‹œ
- ì¼ë°˜ ì ìˆ˜í‘œì™€ ë¶„ë¦¬

**âœ… ê²€ì¦ ê²°ê³¼**: 
- **ê¸°ëŠ¥ ë¶„ë¦¬**: âœ… ëª¨ë“  ê¸°ëŠ¥ì´ ë…ë¦½ì ìœ¼ë¡œ ì‘ë™
- **ì˜í–¥ ì—†ìŒ**: âœ… ë‹¤ë¥¸ ê¸°ëŠ¥ì— ì˜í–¥ì„ ì£¼ì§€ ì•ŠìŒ

---

## 8. ì¢…í•© í‰ê°€

### âœ… ëª¨ë“  ê¸°ëŠ¥ ì •ìƒ ì‘ë™

1. **1ë“± ë™ì ì ê°ì§€ ë° ì•Œë¦¼**: âœ… ëª¨ë“  ê·¸ë£¹ì—ì„œ ì •ìƒ ì‘ë™
2. **ë°±ì¹´ìš´íŠ¸ ì ìš©**: âœ… ì •ìƒ ì‘ë™, ì „ê´‘íŒ ë°˜ì˜ ì •ìƒ
3. **ì„œë“ ë°ìŠ¤ ê¸°ëŠ¥**: âœ… ì½”ìŠ¤/í™€ ì„¤ì • ì •ìƒ, ì ìˆ˜ ì…ë ¥ ì •ìƒ, ìˆœìœ„ ê³„ì‚° ì •ìƒ, ì „ê´‘íŒ í‘œì‹œ ì •ìƒ
4. **NTP ê¸°ëŠ¥**: âœ… ìˆœìœ„ ì„ íƒ ì •ìƒ, ì „ê´‘íŒ ë°˜ì˜ ì •ìƒ
5. **ì„œë“ ë°ìŠ¤ ë™ì ì ì²˜ë¦¬**: âœ… ë™ì ì ì²˜ë¦¬ ì •ìƒ, NTPë¡œ ê²°ì • ê°€ëŠ¥
6. **ê´€ë¦¬ì ìˆœìœ„ ì„ íƒ**: âœ… ìˆœìœ„ ì„ íƒ ì •ìƒ, ì „ê´‘íŒ ë°˜ì˜ ì •ìƒ

### âœ… ì½”ë“œ ì¶©ëŒ ì—†ìŒ

1. **ë°ì´í„° êµ¬ì¡°**: âœ… ì™„ì „íˆ ë¶„ë¦¬ëœ ê²½ë¡œ
2. **ìƒíƒœ ê´€ë¦¬**: âœ… ë…ë¦½ì ì¸ ìƒíƒœ ê´€ë¦¬
3. **ìˆœìœ„ ê³„ì‚°**: âœ… ëª…í™•í•œ ìš°ì„ ìˆœìœ„
4. **ë‹¤ë¥¸ ê¸°ëŠ¥**: âœ… ì˜í–¥ ì—†ìŒ

### âœ… ì ì¬ì  ë¬¸ì œì  ì—†ìŒ

ëª¨ë“  ê¸°ëŠ¥ì´ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•˜ë©°, ì½”ë“œ ì¶©ëŒì´ë‚˜ ë‹¤ë¥¸ ê¸°ëŠ¥ì— ëŒ€í•œ ì˜í–¥ì´ ì—†ìŠµë‹ˆë‹¤.

---

## ê²€ì¦ ì™„ë£Œ

**ê²€ì¦ì**: AI Assistant  
**ê²€ì¦ ì¼ì**: 2024ë…„  
**ê²€ì¦ ë²”ìœ„**: í”Œë ˆì´ì˜¤í”„ ë° ì„œë“ ë°ìŠ¤ ê¸°ëŠ¥ ì „ë°˜

